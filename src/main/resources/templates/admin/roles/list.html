<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">

<head th:replace="admin/fragments/admin-head :: admin-head('Quản lý vai trò - Liora Admin')"></head>

<body class="with-welcome-text roles-page">
    <div class="container-scroller">
        <div class="container-fluid page-body-wrapper">
            <div th:replace="admin/layout/admin-navbar"></div>
            <div th:replace="admin/layout/admin-sidebar"></div>

            <div class="main-panel">
                <div class="content-wrapper">
                    <!-- Page Header -->
                    <div class="d-sm-flex align-items-center justify-content-between border-bottom mb-3">
                        <h1 class="h3 mb-0">Quản lý vai trò</h1>
                        <nav aria-label="breadcrumb">
                            <ol class="breadcrumb">
                                <li class="breadcrumb-item"><a href="/admin/dashboard">Dashboard</a></li>
                                <li class="breadcrumb-item active">Vai trò</li>
                            </ol>
                        </nav>
                    </div>

                    <!-- Action Buttons -->
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <div>
                            <button type="button" class="btn btn-primary text-white me-2" id="managePermissionsBtn">
                                <i class="mdi mdi-shield-key-outline"></i> Phân quyền
                            </button>
                            <button type="button" class="btn btn-outline-secondary">
                                <i class="mdi mdi-file-excel"></i> Xuất Excel
                            </button>
                        </div>
                        <button type="button" class="btn btn-outline-secondary" onclick="location.reload()">
                            <i class="mdi mdi-refresh"></i> Làm mới
                        </button>
                    </div>



                    <!-- Quick Stats -->
                    <div class="row mb-4">
                        <div class="col-md-4">
                            <div class="card bg-primary text-white">
                                <div class="card-body">
                                    <div class="d-flex align-items-center">
                                        <div class="flex-grow-1">
                                            <h6 class="card-title">Tổng vai trò</h6>
                                            <h3 class="mb-0" id="totalRoles">0</h3>
                                        </div>
                                        <div class="flex-shrink-0">
                                            <i class="mdi mdi-account-check-outline mdi-24px"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="card bg-info text-white">
                                <div class="card-body">
                                    <div class="d-flex align-items-center">
                                        <div class="flex-grow-1">
                                            <h6 class="card-title">Tổng quyền hạn</h6>
                                            <h3 class="mb-0" id="totalPermissions">0</h3>
                                        </div>
                                        <div class="flex-shrink-0">
                                            <i class="mdi mdi-shield-key-outline mdi-24px"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="card bg-warning text-white">
                                <div class="card-body">
                                    <div class="d-flex align-items-center">
                                        <div class="flex-grow-1">
                                            <h6 class="card-title">Tổng người dùng</h6>
                                            <h3 class="mb-0" id="totalUsers">0</h3>
                                        </div>
                                        <div class="flex-shrink-0">
                                            <i class="mdi mdi-account-group-outline mdi-24px"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Roles List -->
                    <div class="card card-rounded mb-4">
                        <div class="card-body">
                            <h4 class="card-title card-title-dash">Danh sách vai trò</h4>
                            <div class="table-responsive">
                                <table class="table table-hover">
                                    <thead class="table-light">
                                        <tr>
                                            <th>Vai trò</th>
                                            <th>Mô tả</th>
                                            <th>Quyền hạn</th>
                                            <th>Thao tác</th>
                                        </tr>
                                    </thead>
                                    <tbody class="roles-container">
                                        <!-- Roles will be loaded here via JavaScript -->
                                        <tr>
                                            <td colspan="4" class="text-center py-5">
                                                <div class="spinner-border text-primary" role="status">
                                                    <span class="visually-hidden">Đang tải...</span>
                                                </div>
                                                <p class="mt-3 text-muted">Đang tải danh sách vai trò...</p>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <!-- Pagination -->
                    <div class="d-flex justify-content-between align-items-center">
                        <div class="text-muted" id="paginationInfo">
                            <!-- Pagination info will be updated via JavaScript -->
                        </div>
                        <nav>
                            <ul class="pagination mb-0" id="pagination">
                                <!-- Pagination will be generated via JavaScript -->
                            </ul>
                        </nav>
                    </div>
                </div>
                <div th:replace="admin/layout/admin-footer"></div>
            </div>
        </div>
    </div>

    <!-- Permission Management Modal -->
    <div class="modal fade" id="permissionModal" tabindex="-1">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header bg-primary text-white">
                    <h5 class="modal-title">
                        <i class="mdi mdi-shield-key-outline me-2"></i>Phân quyền
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-4">
                            <h6 class="fw-bold mb-3">Chọn vai trò</h6>
                            <div class="list-group" id="roleList">
                                <!-- Roles will be loaded here -->
                            </div>
                        </div>
                        <div class="col-md-8">
                            <h6 class="fw-bold mb-3">Phân quyền theo danh mục</h6>
                            <div id="permissionCategories">
                                <!-- Permission categories will be loaded here -->
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">
                        <i class="mdi mdi-close"></i> Hủy bỏ
                    </button>
                    <button type="button" class="btn btn-primary" id="savePermissions">
                        <i class="mdi mdi-content-save"></i> Lưu quyền hạn
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div class="modal fade" id="deleteModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header bg-danger text-white">
                    <h5 class="modal-title">
                        <i class="mdi mdi-alert-circle-outline me-2"></i>Xác nhận xóa vai trò
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="text-center mb-3">
                        <i class="mdi mdi-delete-alert mdi-48px text-danger"></i>
                    </div>
                    <p class="text-center mb-3">
                        Bạn có chắc chắn muốn xóa vai trò <strong id="deleteRoleName" class="text-danger"></strong>?
                    </p>
                    <div class="alert alert-warning">
                        <i class="mdi mdi-alert-outline me-2"></i>
                        <strong>Cảnh báo:</strong> Vai trò này có thể đang được sử dụng bởi <span
                            id="deleteRoleUserCount" class="fw-bold">0</span> người dùng. Hành động này không thể hoàn
                        tác!
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">
                        <i class="mdi mdi-close"></i> Hủy bỏ
                    </button>
                    <button type="button" class="btn btn-danger text-white" id="confirmDelete">
                        <i class="mdi mdi-delete"></i> Xóa vai trò
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div th:replace="admin/fragments/admin-scripts :: admin-scripts"></div>
    <script src="/admin/js/admin/roles.js"></script>
</body>

</html>